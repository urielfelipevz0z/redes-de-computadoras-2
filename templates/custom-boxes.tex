% Configuración personalizada de cajas para documentos técnicos
% Usando tcolorbox con iconos FontAwesome

\usepackage[most]{tcolorbox}
\tcbuselibrary{skins,listings,breakable}
\usepackage{fontawesome5}

% Redefinir includegraphics para limitar el tamaño de las imágenes
\usepackage{graphicx}
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{%
  \oldincludegraphics[width=\linewidth,#1]{#2}%
}

% Definir colores personalizados para notificaciones
\definecolor{infocolor}{RGB}{58, 135, 173}
\definecolor{warningcolor}{RGB}{245, 166, 35}
\definecolor{errorcolor}{RGB}{208, 2, 27}
\definecolor{successcolor}{RGB}{40, 167, 69}

% Definir colores para terminales (más realistas)
\definecolor{ciscoioscolor}{RGB}{0, 51, 102}        % Azul oscuro Cisco
\definecolor{ciscoiosbg}{RGB}{240, 248, 255}       % Fondo azul muy claro
\definecolor{ciscotext}{RGB}{0, 0, 0}              % Texto negro base para Cisco
\definecolor{ciscokeyword}{RGB}{0, 0, 255}         % Azul para keywords Cisco
\definecolor{ciscocomment}{RGB}{0, 128, 0}         % Verde para comentarios Cisco
\definecolor{ciscoprompt}{RGB}{0, 51, 102}         % Azul Cisco para prompt

\definecolor{bashcolor}{RGB}{45, 45, 45}           % Negro/gris oscuro para borde
\definecolor{bashbg}{RGB}{48, 10, 36}              % Fondo morado/negro Linux
\definecolor{bashtext}{RGB}{255, 255, 255}         % Texto blanco
\definecolor{bashkeyword}{RGB}{97, 175, 239}       % Azul claro para keywords Bash
\definecolor{bashstring}{RGB}{152, 195, 121}       % Verde para strings
\definecolor{bashcomment}{RGB}{92, 99, 112}        % Gris para comentarios
\definecolor{bashprompt}{RGB}{0, 255, 0}           % Verde clásico Linux para prompt

% Caja de información
\newtcolorbox{info-box}{
  colback=infocolor!10,
  colframe=infocolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{infocolor}{\Large\faInfoCircle}\enspace}
}

% Caja de advertencia
\newtcolorbox{warning-box}{
  colback=warningcolor!10,
  colframe=warningcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{warningcolor}{\Large\faExclamationTriangle}\enspace}
}

% Caja de error
\newtcolorbox{error-box}{
  colback=errorcolor!10,
  colframe=errorcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{errorcolor}{\Large\faTimes}\enspace}
}

% Caja de éxito
\newtcolorbox{success-box}{
  colback=successcolor!10,
  colframe=successcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{successcolor}{\Large\faCheck}\enspace}
}

% Configuración de highlighting mejorado para código Cisco IOS
\lstdefinelanguage{cisco-ios}{
  keywords={interface, ip, router, switch, vlan, access, trunk, enable, configure, terminal, show, clear, debug, no, shutdown, description, switchport, mode, spanning-tree, portfast, line, con, vty, login, password, secret, hostname, banner, motd, end, exit, copy, running-config, startup-config, tftp, flash, reload, write, memory, erase},
  keywordstyle=\color{ciscokeyword}\bfseries,
  ndkeywords={FastEthernet, GigabitEthernet, Serial, Loopback, VLAN, address, route, protocol, security, range, default-gateway, dynamic, static, count, version, brief, detail, trunk, native, allowed},
  ndkeywordstyle=\color{blue!70}\bfseries,
  identifierstyle=\color{ciscotext},
  comment=[l]{\#},
  comment=[l]{!},
  commentstyle=\color{ciscocomment}\ttfamily,
  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  % Detección de prompts Cisco
  moredelim=[s][\color{ciscoprompt}\bfseries]{Switch>}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{Switch\#}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1>}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1\#}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1(config)\#}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1(config-if)\#}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1(config-if-range)\#}{\ },
  moredelim=[s][\color{ciscoprompt}\bfseries]{SW1(config-line)\#}{\ },
  basicstyle=\color{ciscotext}\ttfamily\footnotesize,
}

% Estilo mejorado para código bash/shell
\lstdefinelanguage{bash}{
  keywords={sudo, apt, update, install, which, dpkg, ping, echo, nc, tshark, wireshark, macof, grep, cat, head, tail, chmod, cp, mv, rm, ls, cd, mkdir, netstat, ss, ps, kill, top, htop, systemctl, service, iptables, tcpdump, nmap, curl, wget},
  keywordstyle=\color{bashkeyword}\bfseries,
  ndkeywords={-c, -i, -f, -u, -l, -y, --version, -lu, -p, -n, -r, -4, -6, --help, -v, -a, -la, -lh, -rf},
  ndkeywordstyle=\color{cyan}\bfseries,
  identifierstyle=\color{bashtext},
  comment=[l]{\#},
  commentstyle=\color{bashcomment}\ttfamily,
  stringstyle=\color{bashstring}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  % Detección de prompts Linux que terminan en $
  moredelim=[s][\color{bashprompt}\bfseries]{ccna@}{$},
  moredelim=[s][\color{bashprompt}\bfseries]{root@}{$},
  moredelim=[s][\color{bashprompt}\bfseries]{user@}{$},
  basicstyle=\color{bashtext}\ttfamily\footnotesize,
}

% Terminal Cisco IOS - Con preservación de saltos de línea usando tcblisting
\newtcblisting{cisco-ios-box}{
  enhanced,
  colback=ciscoiosbg,
  colframe=ciscoioscolor,
  arc=4pt,
  outer arc=4pt,
  left=12pt,
  right=12pt,
  top=12pt,
  bottom=12pt,
  fonttitle=\bfseries\color{white},
  title={\faNetworkWired\enspace Cisco IOS Terminal},
  coltitle=white,
  colbacktitle=ciscoioscolor,
  boxed title style={arc=3pt},
  breakable,
  listing only,
  listing options={
    language=cisco-ios,
    basicstyle=\ttfamily\footnotesize\color{ciscotext},
    breaklines=true,
    columns=fullflexible,
    keepspaces=true,
    numbers=none,
    frame=none,
    backgroundcolor=\color{ciscoiosbg},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    escapeinside={(*@}{@*)},
  },
}

% Terminal Bash/Linux - Con preservación de saltos de línea usando tcblisting
\newtcblisting{bash-box}{
  enhanced,
  colback=bashbg,
  colframe=bashcolor,
  arc=4pt,
  outer arc=4pt,
  left=12pt,
  right=12pt,
  top=12pt,
  bottom=12pt,
  fonttitle=\bfseries\color{white},
  title={\faTerminal\enspace Linux Terminal},
  coltitle=white,
  colbacktitle=bashcolor,
  boxed title style={arc=3pt},
  breakable,
  listing only,
  listing options={
    language=bash,
    basicstyle=\ttfamily\footnotesize\color{bashtext},
    breaklines=true,
    columns=fullflexible,
    keepspaces=true,
    numbers=none,
    frame=none,
    backgroundcolor=\color{bashbg},
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    escapeinside={(*@}{@*)},
  },
}

% Configuración global optimizada de listings
\lstset{
  basicstyle=\footnotesize\ttfamily,
  backgroundcolor=\color{white},
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  numbersep=8pt,
  breakindent=1.5em,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  tabsize=4
}

% Comandos simples para colorear elementos específicos
\newcommand{\cprompt}[1]{\textcolor{ciscoprompt}{\bfseries#1}}
\newcommand{\ccmd}[1]{\textcolor{ciscokeyword}{\bfseries#1}}
\newcommand{\ccomment}[1]{\textcolor{ciscocomment}{#1}}

\newcommand{\bprompt}[1]{\textcolor{bashprompt}{\bfseries#1}}
\newcommand{\bcmd}[1]{\textcolor{bashkeyword}{\bfseries#1}}
\newcommand{\bstring}[1]{\textcolor{bashstring}{#1}}
\newcommand{\bcomment}[1]{\textcolor{bashcomment}{#1}}

% Ambientes simplificados para uso directo en markdown
\newenvironment{ciscoios}{\begin{cisco-ios-box}}{\end{cisco-ios-box}}
\newenvironment{linuxterm}{\begin{bash-box}}{\end{bash-box}}
