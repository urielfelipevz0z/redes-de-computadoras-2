% Configuración personalizada de cajas para documentos técnicos
% Usando tcolorbox con iconos FontAwesome

\usepackage[most]{tcolorbox}
\tcbuselibrary{skins,listings,breakable}
\usepackage{fontawesome5}

% Redefinir includegraphics para limitar el tamaño de las imágenes
\usepackage{graphicx}
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{%
  \oldincludegraphics[width=\linewidth,#1]{#2}%
}

% Definir colores personalizados para notificaciones
\definecolor{infocolor}{RGB}{58, 135, 173}
\definecolor{warningcolor}{RGB}{245, 166, 35}
\definecolor{errorcolor}{RGB}{208, 2, 27}
\definecolor{successcolor}{RGB}{40, 167, 69}

% Definir colores para terminales (más realistas)
\definecolor{ciscoioscolor}{RGB}{0, 51, 102}        % Azul oscuro Cisco
\definecolor{ciscoiosbg}{RGB}{240, 248, 255}       % Fondo azul muy claro
\definecolor{ciscotext}{RGB}{0, 0, 0}              % Texto negro base para Cisco
\definecolor{ciscokeyword}{RGB}{0, 0, 255}         % Azul para keywords Cisco
\definecolor{ciscocomment}{RGB}{0, 128, 0}         % Verde para comentarios Cisco

\definecolor{bashcolor}{RGB}{45, 45, 45}           % Negro/gris oscuro para borde
\definecolor{bashbg}{RGB}{48, 10, 36}              % Fondo morado/negro Linux
\definecolor{bashtext}{RGB}{255, 255, 255}         % Texto blanco

\definecolor{bashkeyword}{RGB}{97, 175, 239}       % Azul claro para keywords Bash
\definecolor{bashstring}{RGB}{152, 195, 121}       % Verde para strings
\definecolor{bashcomment}{RGB}{92, 99, 112}        % Gris para comentarios
\definecolor{bashprompt}{RGB}{224, 108, 117}       % Rojo claro para prompt

% Caja de información
\newtcolorbox{info-box}{
  colback=infocolor!10,
  colframe=infocolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,q
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{infocolor}{\Large\faInfoCircle}\enspace}
}

% Caja de advertencia
\newtcolorbox{warning-box}{
  colback=warningcolor!10,
  colframe=warningcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{warningcolor}{\Large\faExclamationTriangle}\enspace}
}

% Caja de error
\newtcolorbox{error-box}{
  colback=errorcolor!10,
  colframe=errorcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{errorcolor}{\Large\faTimes}\enspace}
}

% Caja de éxito
\newtcolorbox{success-box}{
  colback=successcolor!10,
  colframe=successcolor,
  arc=2pt,
  outer arc=2pt,
  leftrule=4pt,
  rightrule=0pt,
  toprule=0pt,
  bottomrule=0pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt,
  before upper={\parindent15pt\noindent\textcolor{successcolor}{\Large\faCheck}\enspace}
}

% Configuración de highlighting mejorado para código Cisco IOS
\lstdefinelanguage{cisco-ios}{
  keywords={interface, ip, router, switch, vlan, access, trunk, enable, configure, terminal, show, clear, debug, no, shutdown, description, switchport, mode, spanning-tree, portfast, line, con, vty, login, password, secret, hostname, banner, motd, end, exit, copy, running-config, startup-config, tftp, flash, reload, write, memory, erase},
  keywordstyle=\color{ciscokeyword}\bfseries,
  ndkeywords={FastEthernet, GigabitEthernet, Serial, Loopback, VLAN, address, route, protocol, security, range, default-gateway, dynamic, static, count, version, brief, detail, trunk, native, allowed},
  ndkeywordstyle=\color{blue!70}\bfseries,
  identifierstyle=\color{ciscotext},
  sensitive=false,
  comment=[l]{\#},
  comment=[l]{!},
  commentstyle=\color{ciscocomment}\ttfamily,
  stringstyle=\color{red}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  basicstyle=\color{ciscotext}\ttfamily\footnotesize,
  breaklines=true,
  breakatwhitespace=true,
  columns=flexible
}

% Estilo mejorado para código bash/shell
\lstdefinelanguage{bash}{
  keywords={sudo, apt, update, install, which, dpkg, ping, echo, nc, tshark, wireshark, macof, grep, cat, head, tail, chmod, cp, mv, rm, ls, cd, mkdir, netstat, ss, ps, kill, top, htop, systemctl, service, iptables, tcpdump, nmap, curl, wget},
  keywordstyle=\color{bashkeyword}\bfseries,
  ndkeywords={-c, -i, -f, -u, -l, -y, --version, -lu, -p, -n, -r, -4, -6, --help, -v, -a, -la, -lh, -rf},
  ndkeywordstyle=\color{cyan}\bfseries,
  identifierstyle=\color{bashtext},
  sensitive=true,
  comment=[l]{\#},
  commentstyle=\color{bashcomment}\ttfamily,
  stringstyle=\color{bashstring}\ttfamily,
  morestring=[b]',
  morestring=[b]",
  basicstyle=\color{bashtext}\ttfamily\footnotesize,
  breaklines=true,
  breakatwhitespace=true,
  columns=flexible
}

% Terminal Cisco IOS - Estilo realista con prompt
\newtcolorbox{cisco-ios-box}{
  enhanced,
  colback=ciscoiosbg,
  colframe=ciscoioscolor,
  arc=4pt,
  outer arc=4pt,
  left=12pt,
  right=12pt,
  top=12pt,
  bottom=12pt,
  fonttitle=\bfseries\color{white},
  title={\faNetworkWired\enspace Cisco IOS Terminal},
  coltitle=white,
  colbacktitle=ciscoioscolor,
  attach boxed title to top left={yshift=-3mm,xshift=6mm},
  boxed title style={arc=3pt},
  breakable,
  pad at break*=2mm,
  listing only,
  listing options={
    language=cisco-ios,
    basicstyle=\color{ciscotext}\ttfamily\footnotesize,
    backgroundcolor=\color{ciscoiosbg},
    numbers=none,
    showstringspaces=false,
    breaklines=true,
    breakatwhitespace=true,
    breakindent=1em,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    tabsize=4,
    frame=none,
    xleftmargin=0pt,
    xrightmargin=0pt,
    aboveskip=0pt,
    belowskip=0pt,
    columns=flexible,
    keepspaces=true
  }
}

% Terminal Bash/Linux - Estilo realista con prompt ccna@
\newtcolorbox{bash-box}{
  enhanced,
  colback=bashbg,
  colframe=bashcolor,
  arc=4pt,
  outer arc=4pt,
  left=12pt,
  right=12pt,
  top=12pt,
  bottom=12pt,
  fonttitle=\bfseries\color{white},
  title={\faTerminal\enspace Linux Terminal},
  coltitle=green,
  colbacktitle=bashcolor,
  attach boxed title to top left={yshift=-3mm,xshift=6mm},
  boxed title style={arc=3pt},
  breakable,
  pad at break*=2mm,
  listing only,
  listing options={
    language=bash,
    basicstyle=\color{bashtext}\ttfamily\footnotesize,
    backgroundcolor=\color{bashbg},
    numbers=none,
    showstringspaces=false,
    breaklines=true,
    breakatwhitespace=true,
    breakindent=1em,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    tabsize=4,
    frame=none,
    xleftmargin=0pt,
    xrightmargin=0pt,
    aboveskip=0pt,
    belowskip=0pt,
    columns=flexible,
    keepspaces=true
  }
}

% Configuración global optimizada de listings
\lstset{
  basicstyle=\footnotesize\ttfamily,
  backgroundcolor=\color{white},
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  numbersep=8pt,
  showstringspaces=false,
  breaklines=true,
  breakatwhitespace=true,
  breakindent=1.5em,
  postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
  tabsize=4,
  captionpos=b,
  xleftmargin=0em,
  xrightmargin=0em,
  frame=none,
  aboveskip=5pt,
  belowskip=5pt,
  columns=flexible,
  keepspaces=true
}

% Macros para facilitar el uso de terminales con prompts personalizados

% Macro para comandos Cisco con prompt personalizado
\newcommand{\ciscoprompt}[1]{{\color{ciscokeyword}\bfseries#1}}
\newcommand{\ciscousermode}[1]{\ciscoprompt{#1>}}
\newcommand{\ciscoprivmode}[1]{\ciscoprompt{#1\#}}
\newcommand{\ciscoconfmode}[1]{\ciscoprompt{#1(config)\#}}
\newcommand{\ciscointfmode}[2]{\ciscoprompt{#1(config-if)\#}}

% Macro para comandos Linux con prompt ccna@
\newcommand{\bashprompt}[1]{{\color{bashprompt}\bfseries ccna@#1:\$}}
\newcommand{\rootprompt}[1]{{\color{red}\bfseries root@#1:\#}}

% Ambientes simplificados para uso directo en markdown
\newenvironment{ciscoios}{\begin{cisco-ios-box}}{\end{cisco-ios-box}}
\newenvironment{linuxterm}{\begin{bash-box}}{\end{bash-box}}
